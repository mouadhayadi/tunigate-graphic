[file name]: index.html
[file content begin]
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>محرر تصاميم بوابة تونس - النسخة النهائية</title>
    
    <!-- استدعاء الملفات المحلية -->
    <script src="./js/react.js"></script>
    <script src="./js/react-dom.js"></script>
    <script src="./js/babel.js"></script>
    <script src="./js/tailwind.js"></script>
    <script src="./js/html-to-image.js"></script>
    <script src="./js/html2canvas.js"></script>
    
    <style>
        /* تعريف الخط المحلي المطلوب فقط */
        @font-face {
            font-family: 'DIN Next LT Arabic';
            src: url('./fonts/ArbFONTS-DINNextLTArabic-Regular-2.ttf') format('truetype'); 
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: 'DIN Next LT Arabic', sans-serif;
            background-color: #111827;
            color: white;
            overscroll-behavior: none;
            user-select: none;
        }
        
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #1f2937; }
        ::-webkit-scrollbar-thumb { background: #374151; border-radius: 4px; }

        input[type=range] { accent-color: currentColor; }
        
        .design-canvas {
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5);
            background-color: #13283e; 
            overflow: hidden;
            position: relative;
        }

        .resize-handle {
            width: 14px;
            height: 14px;
            background-color: white;
            border: 2px solid currentColor;
            position: absolute;
            z-index: 50;
            transition: transform 0.1s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.3);
            border-radius: 50%;
        }

        .image-border {
            border-left: 2px dashed rgba(6, 182, 212, 0.7);
            border-right: 2px dashed rgba(6, 182, 212, 0.7);
            position: absolute;
            inset: 0;
            pointer-events: none;
            z-index: 40;
        }

        .noise-overlay {
            position: absolute;
            inset: 0;
            background-image: url("./assets/noise.jpg");
            background-size: cover;
            background-blend-mode: soft-light;
            opacity: 0.05; 
            pointer-events: none;
            z-index: 25; 
        }

        .grid-image-layer {
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            width: 100%;
            pointer-events: none;
            z-index: 20;
        }
        
        .grid-image-layer img {
            width: 100%;
            display: block;
            mask-image: linear-gradient(to top, black 40%, transparent 100%);
            -webkit-mask-image: linear-gradient(to top, black 40%, transparent 100%);
        }

        .vignette-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to bottom, rgba(0,0,0,0) 0%, transparent 50%, rgba(0,0,0,0.5) 100%);
            pointer-events: none;
            z-index: 26; 
        }

        /* إخفاء أدوات التحكم أثناء التصدير */
        .design-canvas.exporting .resize-handle,
        .design-canvas.exporting .image-border {
            display: none !important;
        }

        /* تأثيرات خاصة للرقم */
        .number-glow {
            text-shadow: 
                0 0 20px rgba(255, 90, 76, 0.8),
                0 0 40px rgba(255, 90, 76, 0.4),
                0 0 60px rgba(255, 90, 76, 0.2);
        }

        .number-container {
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
            z-index: 30;
        }

        .number-backdrop {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 100%;
            height: 100%;
            background: radial-gradient(
                ellipse at center,
                rgba(255, 90, 76, 0.15) 0%,
                rgba(255, 90, 76, 0.05) 50%,
                transparent 70%
            );
            border-radius: 20px;
            z-index: -1;
            filter: blur(10px);
        }

        /* شريط العنوان المميز */
        .title-ribbon {
            background: linear-gradient(90deg, 
                rgba(255, 90, 76, 0.9) 0%, 
                rgba(255, 90, 76, 0.7) 50%, 
                rgba(255, 90, 76, 0.4) 100%);
            padding: 12px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(255, 90, 76, 0.3);
            position: relative;
            overflow: hidden;
        }

        .title-ribbon::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(255, 255, 255, 0.2) 50%, 
                transparent 100%);
            animation: shimmer 3s infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        /* تصميم اللوكيشن بدون مربع */
        .location-simple {
            display: flex;
            align-items: center;
            gap: 6px;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.5);
        }

        .location-text-simple {
            font-size: 12px;
            font-weight: 500;
            line-height: 1.2;
            padding-top: 1px; /* رفع النص قليلاً */
        }

        /* تنسيق صورة عاجل القابلة للتحريك */
        .urgent-image {
            position: relative;
            transition: transform 0.2s ease;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;

        const IconBase = ({ children, size = 24, className = "" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const LayoutTemplate = (props) => (<IconBase {...props}><rect width="18" height="18" x="3" y="3" rx="2" ry="2" /><line x1="3" x2="21" y1="9" y2="9" /><line x1="9" x2="9" y1="21" y2="9" /></IconBase>);
        const Monitor = (props) => (<IconBase {...props}><rect width="20" height="14" x="2" y="3" rx="2" /><line x1="8" x2="16" y1="21" y2="21" /><line x1="12" x2="12" y1="17" y2="21" /></IconBase>);
        const Smartphone = (props) => (<IconBase {...props}><rect width="14" height="20" x="5" y="2" rx="2" ry="2" /><path d="M12 18h.01" /></IconBase>);
        const ImageIco = (props) => (<IconBase {...props}><rect width="18" height="18" x="3" y="3" rx="2" ry="2" /><circle cx="8.5" cy="8.5" r="1.5" /><path d="m21 15-5-5L5 21" /></IconBase>);
        const Download = (props) => (<IconBase {...props}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" /><polyline points="7 10 12 15 17 10" /><line x1="12" x2="12" y1="15" y2="3" /></IconBase>);
        const MapPin = (props) => (<IconBase {...props}><path d="M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z" /><circle cx="12" cy="10" r="3" /></IconBase>);
        const Move = (props) => (<IconBase {...props}><polyline points="5 9 2 12 5 15" /><polyline points="9 5 12 2 15 5" /><polyline points="19 9 22 12 19 15" /><polyline points="9 19 12 22 15 19" /><line x1="2" x2="22" y1="12" y2="12" /><line x1="12" x2="12" y1="2" y2="22" /></IconBase>);
        const Palette = (props) => (<IconBase {...props}><circle cx="13.5" cy="6.5" r=".5" /><circle cx="17.5" cy="10.5" r=".5" /><circle cx="8.5" cy="7.5" r=".5" /><circle cx="6.5" cy="12.5" r=".5" /><path d="M12 2C6.5 2 2 6.5 2 12s4.5 10 10 10c.926 0 1.648-.746 1.648-1.688 0-.437-.18-.835-.437-1.125-.29-.289-.438-.652-.438-1.125a1.64 1.64 0 0 1 1.668-1.668h1.996c3.051 0 5.555-2.503 5.555-5.554C21.965 6.012 17.461 2 12 2z" /></IconBase>);
        const Hash = (props) => (<IconBase {...props}><line x1="4" x2="20" y1="9" y2="9" /><line x1="4" x2="20" y1="15" y2="15" /><line x1="10" x2="8" y1="3" y2="21" /><line x1="16" x2="14" y1="3" y2="21" /></IconBase>);
        const CodeXml = (props) => (<IconBase {...props}><path d="m18 16 4-4-4-4" /><path d="m6 8-4 4 4 4" /><line x1="14.5" x2="9.5" y1="4" y2="20" /></IconBase>);
        const Sliders = (props) => (<IconBase {...props}><line x1="4" x2="4" y1="21" y2="14" /><line x1="4" x2="4" y1="10" y2="3" /><line x1="12" x2="12" y1="21" y2="12" /><line x1="12" x2="12" y1="8" y2="3" /><line x1="20" x2="20" y1="21" y2="16" /><line x1="20" x2="20" y1="12" y2="3" /><line x1="2" x2="6" y1="14" y2="14" /><line x1="10" x2="14" y1="8" y2="8" /><line x1="18" x2="22" y1="16" y2="16" /></IconBase>);
        const Maximize = (props) => (<IconBase {...props}><path d="M8 3H5a2 2 0 0 0-2 2v3" /><path d="M21 8V5a2 2 0 0 0-2-2h-3" /><path d="M3 16v3a2 2 0 0 0 2 2h3" /><path d="M16 21h3a2 2 0 0 0 2-2v-3" /></IconBase>);
        const AlertTriangle = (props) => (<IconBase {...props}><path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z" /><line x1="12" x2="12" y1="9" y2="13" /><line x1="12" x2="12.01" y1="17" y2="17" /></IconBase>);

        const themes = {
            news: { id: 'news', name: 'أخبار', iconColor: 'text-cyan-400', accentColor: 'bg-cyan-500', borderColor: 'border-cyan-500', primary: '#0f304e', secondary: 'rgba(15, 48, 78, 0.9)', tint: 'rgba(6, 182, 212, 0.15)' },
            sports: { id: 'sports', name: 'رياضة', iconColor: 'text-emerald-400', accentColor: 'bg-emerald-600', borderColor: 'border-emerald-600', primary: '#022c22', secondary: 'rgba(4, 120, 87, 0.9)', tint: 'rgba(16, 185, 129, 0.2)' },
            culture: { id: 'culture', name: 'ثقافة', iconColor: 'text-purple-400', accentColor: 'bg-purple-500', borderColor: 'border-purple-500', primary: '#2e1065', secondary: 'rgba(46, 16, 101, 0.9)', tint: 'rgba(139, 92, 246, 0.15)' },
            breaking: { id: 'breaking', name: 'عاجل', iconColor: 'text-red-500', accentColor: 'bg-red-600', borderColor: 'border-red-600', primary: '#450a0a', secondary: 'rgba(185, 28, 28, 0.95)', tint: 'rgba(239, 68, 68, 0.25)' },
            number: { id: 'number', name: 'رقم اليوم', iconColor: 'text-amber-500', accentColor: 'bg-amber-600', borderColor: 'border-amber-600', primary: '#111827', secondary: '#ff5a4c', tint: 'rgba(255, 90, 76, 0.2)' },
            image: { id: 'image', name: 'صورة', iconColor: 'text-gray-300', accentColor: 'bg-gray-500', borderColor: 'border-gray-500', primary: '#111827', secondary: 'rgba(0, 0, 0, 0.6)', tint: 'transparent' }
        };

        function App() {
            const [format, setFormat] = useState('post'); 
            const [activeTheme, setActiveTheme] = useState('number');
            const [text, setText] = useState('خليل العياري ينتقل رسميّا إلى\nباريس سان جيرمان');
            const [fontSize, setFontSize] = useState(25); 
            const [lineHeight, setLineHeight] = useState(1.5);
            const [specialNumber, setSpecialNumber] = useState('284');
            const [specialUnit, setSpecialUnit] = useState('مليون دينار');
            const [location, setLocation] = useState('تونس العاصمة');
            const [showLocation, setShowLocation] = useState(true);
            const [source, setSource] = useState('المصدر: وكالات');
            const [mainImage, setMainImage] = useState(null);
            const [imgScale, setImgScale] = useState(1.3);
            const [imgPos, setImgPos] = useState({ x: 0, y: 0 });
            const [interactionMode, setInteractionMode] = useState(null); 
            const [dragStart, setDragStart] = useState({ x: 0, y: 0 });
            const [initialScale, setInitialScale] = useState(1.0);
            const [initialDist, setInitialDist] = useState(0); 
            const [customFont, setCustomFont] = useState("'DIN Next LT Arabic', sans-serif"); 
            
            // تصحيح مسارات الملفات المحلية
            const logoUrl = './assets/logo.png';
            const gridUrl = './assets/grid.png';
            const urgentUrl = './assets/urgent.png';
            const [imgBrightness, setImgBrightness] = useState(100);

            // تحكمات جديدة للتصميم المعدل
            const [textY, setTextY] = useState(0); 
            const [numberY, setNumberY] = useState(40); // موقع الرقم (40px للأسفل)
            const [numberSize, setNumberSize] = useState(72); // حجم الرقم
            const [unitSize, setUnitSize] = useState(24); // حجم الوحدة
            const [glowIntensity, setGlowIntensity] = useState(80); // شدة التوهج
            const [titleStyle, setTitleStyle] = useState('ribbon'); // نمط العنوان: ribbon أو normal
            
            // تحكم في موقع اللوكيشن
            const [locationX, setLocationX] = useState(0);
            const [locationY, setLocationY] = useState(0);

            // تحكم في موقع صورة عاجل
            const [urgentX, setUrgentX] = useState(0);
            const [urgentY, setUrgentY] = useState(0);
            const [urgentSize, setUrgentSize] = useState(100); // حجم صورة عاجل (نسبة مئوية)

            const canvasRef = useRef(null);
            const imageContainerRef = useRef(null); 
            const [isGenerating, setIsGenerating] = useState(false);
            const [downloadError, setDownloadError] = useState(null);

            useEffect(() => {
                setMainImage('https://images.unsplash.com/photo-1544985335-51206f363c3f?q=80&w=2670&auto=format&fit=crop'); 
            }, []);

            const currentThemeConfig = themes[activeTheme];

            // Image manipulation functions
            const getDistanceFromCenter = (clientX, clientY) => { if (!imageContainerRef.current) return 0; const rect = imageContainerRef.current.getBoundingClientRect(); const centerX = rect.left + rect.width / 2; const centerY = rect.top + rect.height / 2; return Math.sqrt(Math.pow(clientX - centerX, 2) + Math.pow(clientY - centerY, 2)); };
            const handleMouseDown = (e, mode) => { e.stopPropagation(); e.preventDefault(); setInteractionMode(mode); if (mode === 'resize') { setInitialScale(imgScale); setInitialDist(getDistanceFromCenter(e.clientX, e.clientY)); } else { setDragStart({ x: e.clientX, y: e.clientY }); } };
            const handleTouchStart = (e, mode) => { e.stopPropagation(); setInteractionMode(mode); if (mode === 'resize') { setInitialScale(imgScale); setInitialDist(getDistanceFromCenter(e.touches[0].clientX, e.touches[0].clientY)); } else { setDragStart({ x: e.touches[0].clientX, y: e.touches[0].clientY }); } };
            const handleMove = (clientX, clientY) => { if (!interactionMode) return; if (interactionMode === 'move') { const dx = clientX - dragStart.x; const dy = clientY - dragStart.y; setImgPos(prev => ({ x: prev.x + dx, y: prev.y + dy })); setDragStart({ x: clientX, y: clientY }); } else if (interactionMode === 'resize') { const currentDist = getDistanceFromCenter(clientX, clientY); if (initialDist > 0) { const scaleFactor = currentDist / initialDist; const newScale = Math.max(0.1, Math.min(5, initialScale * scaleFactor)); setImgScale(newScale); } } };
            const handleMouseMove = (e) => handleMove(e.clientX, e.clientY);
            const handleTouchMove = (e) => handleMove(e.touches[0].clientX, e.touches[0].clientY);
            const handleEnd = () => setInteractionMode(null);
            useEffect(() => { if (interactionMode) { window.addEventListener('mousemove', handleMouseMove); window.addEventListener('mouseup', handleEnd); window.addEventListener('touchmove', handleTouchMove); window.addEventListener('touchend', handleEnd); } return () => { window.removeEventListener('mousemove', handleMouseMove); window.removeEventListener('mouseup', handleEnd); window.removeEventListener('touchmove', handleTouchMove); window.removeEventListener('touchend', handleEnd); }; }, [interactionMode, dragStart]);
            
            const getFadeOverlayStyle = () => { if (activeTheme === 'image') return 'transparent'; return `linear-gradient(to bottom, transparent 50%, ${currentThemeConfig.primary} 90%)`; };
            const handleImageUpload = (e) => { const file = e.target.files[0]; if (file) { const reader = new FileReader(); reader.onload = (event) => { setMainImage(event.target.result); setImgPos({ x: 0, y: 0 }); setImgScale(1.0); }; reader.readAsDataURL(file); } };
            
            const handleDownload = async () => {
                if (!canvasRef.current) {
                    setDownloadError("لا يمكن العثور على عنصر التصميم");
                    return;
                }
                
                setDownloadError(null);
                canvasRef.current.classList.add('exporting');
                setIsGenerating(true);
                
                try {
                    // الانتظار لتحميل جميع الصور أولاً
                    const images = canvasRef.current.querySelectorAll('img');
                    const imagePromises = Array.from(images).map(img => {
                        if (img.complete) {
                            return Promise.resolve();
                        }
                        return new Promise((resolve) => {
                            img.onload = resolve;
                            img.onerror = resolve; // لا نرفض إذا فشلت صورة
                        });
                    });
                    
                    await Promise.all(imagePromises);
                    
                    // إعدادات html2canvas مبسطة
                    const options = {
                        scale: 2,
                        useCORS: true,
                        backgroundColor: currentThemeConfig.primary,
                        logging: false,
                        width: canvasRef.current.offsetWidth,
                        height: canvasRef.current.offsetHeight,
                        allowTaint: true,
                        foreignObjectRendering: false
                    };
                    
                    const canvas = await html2canvas(canvasRef.current, options);
                    
                    // تحويل Canvas إلى صورة
                    const image = canvas.toDataURL("image/png", 1.0);
                    
                    // تنزيل الصورة
                    const link = document.createElement('a');
                    const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
                    link.download = `tunisia-gate-${format}-${activeTheme}-${timestamp}.png`;
                    link.href = image;
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    
                } catch (err) {
                    console.error("خطأ في التحميل:", err);
                    setDownloadError("حدث خطأ أثناء التحميل. تأكد من أن جميع الصور محملة.");
                } finally {
                    setIsGenerating(false);
                    if(canvasRef.current) canvasRef.current.classList.remove('exporting');
                }
            };

            const styles = { post: { width: '400px', height: '500px' }, story: { width: '360px', height: '640px' } };
            const currentStyle = styles[format];
            const getGradientBackground = () => { const p = currentThemeConfig.primary; const s = currentThemeConfig.secondary; if (activeTheme === 'image') return `linear-gradient(to top, rgba(0,0,0,0.8) 0%, rgba(0,0,0,0) 20%, transparent 100%)`; return `linear-gradient(to top, ${p} 0%, ${p} 15%, ${s} 30%, rgba(0,0,0,0) 40%, transparent 45%)`; };

            // دالة للحصول على نمط التوهج
            const getGlowStyle = () => {
                const intensity = glowIntensity / 100;
                return {
                    textShadow: `0 0 ${20 * intensity}px rgba(255, 90, 76, 0.8),
                                0 0 ${40 * intensity}px rgba(255, 90, 76, 0.4),
                                0 0 ${60 * intensity}px rgba(255, 90, 76, 0.2)`
                };
            };

            return (
                <div className="min-h-screen flex flex-col md:flex-row" style={{ backgroundColor: '#0f172a' }}>
                    <div className="w-full md:w-96 bg-gray-900 border-l border-gray-800 p-6 overflow-y-auto z-10 shadow-2xl h-screen flex flex-col text-right scrollbar-thin">
                        <div className="flex flex-col items-center mb-8 border-b border-gray-800 pb-6">
                            <img src={logoUrl} className="w-24 h-auto object-contain mb-4 drop-shadow-2xl" alt="Tunisia Gate" />
                            <h1 className="text-2xl font-black text-white mb-3 tracking-wide">تصميمات البوابة</h1>
                            <div className="credit-badge px-4 py-1.5 rounded-full flex items-center gap-2 shadow-inner"><span className="text-[10px] text-gray-400 font-medium">تطوير تقني وغرافيك</span><span className="text-[10px] text-cyan-400 font-bold flex items-center gap-1"><CodeXml size={10} /> معاذ عيادي</span></div>
                        </div>

                        <div className="space-y-6 flex-1 pr-2">
                             <div><label className="text-xs font-bold text-gray-400 mb-2 block uppercase flex items-center gap-2"><Palette size={14} /> نوع المحتوى (الثيم)</label><div className="grid grid-cols-3 gap-2">{Object.values(themes).map((t) => (<button key={t.id} onClick={() => setActiveTheme(t.id)} className={`text-xs py-2 rounded-md font-bold transition-all border ${activeTheme === t.id ? `${t.accentColor} text-white border-transparent shadow-lg scale-105` : 'bg-gray-800 text-gray-400 border-gray-700 hover:border-gray-500'}`}>{t.name}</button>))}</div></div>
                            
                            {activeTheme === 'number' && (
                                <div className="bg-gray-800 p-4 rounded-lg border border-gray-700 space-y-3 shadow-sm">
                                    <label className="text-xs font-bold text-gray-400 block uppercase flex items-center gap-2"><Hash size={14} /> بيانات الرقم</label>
                                    <input type="text" value={specialNumber} onChange={(e) => setSpecialNumber(e.target.value)} className="w-full bg-gray-900 border border-gray-600 rounded px-2 py-1 text-sm text-white focus:border-cyan-500 text-right font-bold transition-colors" placeholder="الرقم" />
                                    <input type="text" value={specialUnit} onChange={(e) => setSpecialUnit(e.target.value)} className="w-full bg-gray-900 border border-gray-600 rounded px-2 py-1 text-sm text-white focus:border-cyan-500 text-right transition-colors" placeholder="الوحدة" />
                                </div>
                            )}

                            <div><label className="text-xs font-bold text-gray-400 mb-2 block uppercase">الحجم</label><div className="flex bg-gray-800 p-1 rounded-lg"><button onClick={() => setFormat('post')} className={`flex-1 flex items-center justify-center gap-2 py-2 rounded-md transition-all ${format === 'post' ? `${currentThemeConfig.accentColor} text-white` : 'text-gray-400 hover:text-white'}`}><Monitor size={16} /> Post</button><button onClick={() => setFormat('story')} className={`flex-1 flex items-center justify-center gap-2 py-2 rounded-md transition-all ${format === 'story' ? `${currentThemeConfig.accentColor} text-white` : 'text-gray-400 hover:text-white'}`}><Smartphone size={16} /> Story</button></div></div>
                            
                            <div><label className="text-xs font-bold text-gray-400 mb-2 block uppercase flex items-center gap-2"><Move size={14} /> التحكم في الصورة</label><div className="bg-gray-800 p-3 rounded-lg border border-gray-700 shadow-sm"><div className="mb-1"><div className="flex justify-between text-xs text-white font-bold mb-1"><span>حجم الصورة</span><span className={currentThemeConfig.iconColor}>{Math.round(imgScale * 100)}%</span></div><input type="range" min="0.1" max="3" step="0.01" value={imgScale} onChange={(e) => setImgScale(Number(e.target.value))} className={`w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer`} style={{accentColor: currentThemeConfig.primary}} /></div></div></div>

                            <div className="space-y-4">
                                <label className="text-xs font-bold text-gray-400 mb-2 block uppercase flex items-center gap-2"><Sliders size={14} /> تحريك العناصر</label>
                                <div className="bg-gray-800 p-3 rounded-lg border border-gray-700 shadow-sm space-y-4">
                                    <div><div className="flex justify-between text-xs text-gray-400 mb-1"><span>موقع العنوان (فوق/تحت)</span><span>{textY}px</span></div><input type="range" min="-200" max="200" value={textY} onChange={(e) => setTextY(Number(e.target.value))} className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer" /></div>
                                    
                                    {activeTheme === 'number' && (
                                        <>
                                            <div className="border-t border-gray-700 pt-2">
                                                <p className="text-[10px] text-amber-500 font-bold mb-2 flex items-center gap-1"><Maximize size={10} /> تحكم الرقم والوحدة</p>
                                                <div className="grid grid-cols-2 gap-2 mb-2">
                                                    <div>
                                                        <span className="text-[9px] text-gray-400">موقع الرقم</span>
                                                        <input type="range" min="-100" max="100" value={numberY} onChange={(e) => setNumberY(Number(e.target.value))} className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer" />
                                                        <div className="text-[8px] text-gray-500 mt-1 text-center">{numberY}px</div>
                                                    </div>
                                                    <div>
                                                        <span className="text-[9px] text-gray-400">حجم الرقم</span>
                                                        <input type="range" min="48" max="96" value={numberSize} onChange={(e) => setNumberSize(Number(e.target.value))} className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer" />
                                                        <div className="text-[8px] text-gray-500 mt-1 text-center">{numberSize}px</div>
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-2 gap-2">
                                                    <div>
                                                        <span className="text-[9px] text-gray-400">حجم الوحدة</span>
                                                        <input type="range" min="16" max="36" value={unitSize} onChange={(e) => setUnitSize(Number(e.target.value))} className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer" />
                                                        <div className="text-[8px] text-gray-500 mt-1 text-center">{unitSize}px</div>
                                                    </div>
                                                    <div>
                                                        <span className="text-[9px] text-gray-400">شدة التوهج</span>
                                                        <input type="range" min="0" max="100" value={glowIntensity} onChange={(e) => setGlowIntensity(Number(e.target.value))} className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer" />
                                                        <div className="text-[8px] text-gray-500 mt-1 text-center">{glowIntensity}%</div>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <div className="border-t border-gray-700 pt-2">
                                                <p className="text-[10px] text-cyan-400 font-bold mb-2">نمط العنوان</p>
                                                <div className="flex gap-2">
                                                    <button 
                                                        onClick={() => setTitleStyle('ribbon')}
                                                        className={`flex-1 text-xs py-1.5 rounded ${titleStyle === 'ribbon' ? 'bg-cyan-600 text-white' : 'bg-gray-700 text-gray-300'}`}
                                                    >
                                                        شريط مميز
                                                    </button>
                                                    <button 
                                                        onClick={() => setTitleStyle('normal')}
                                                        className={`flex-1 text-xs py-1.5 rounded ${titleStyle === 'normal' ? 'bg-cyan-600 text-white' : 'bg-gray-700 text-gray-300'}`}
                                                    >
                                                        عادي
                                                    </button>
                                                </div>
                                            </div>
                                        </>
                                    )}

                                    {activeTheme === 'breaking' && (
                                        <div className="border-t border-gray-700 pt-2">
                                            <p className="text-[10px] text-red-400 font-bold mb-2 flex items-center gap-1"><AlertTriangle size={10} /> تحكم في صورة عاجل</p>
                                            <div className="grid grid-cols-2 gap-2 mb-2">
                                                <div>
                                                    <span className="text-[9px] text-gray-400">تحريك أفقي</span>
                                                    <input type="range" min="-200" max="200" value={urgentX} onChange={(e) => setUrgentX(Number(e.target.value))} className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer" />
                                                    <div className="text-[8px] text-gray-500 mt-1 text-center">{urgentX}px</div>
                                                </div>
                                                <div>
                                                    <span className="text-[9px] text-gray-400">تحريك رأسي</span>
                                                    <input type="range" min="-200" max="200" value={urgentY} onChange={(e) => setUrgentY(Number(e.target.value))} className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer" />
                                                    <div className="text-[8px] text-gray-500 mt-1 text-center">{urgentY}px</div>
                                                </div>
                                            </div>
                                            <div>
                                                <span className="text-[9px] text-gray-400">حجم الصورة</span>
                                                <input type="range" min="50" max="150" value={urgentSize} onChange={(e) => setUrgentSize(Number(e.target.value))} className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer" />
                                                <div className="text-[8px] text-gray-500 mt-1 text-center">{urgentSize}%</div>
                                            </div>
                                        </div>
                                    )}
                                    
                                    {/* تحكم في موقع اللوكيشن */}
                                    <div className="border-t border-gray-700 pt-2">
                                        <p className="text-[10px] text-cyan-400 font-bold mb-2 flex items-center gap-1"><MapPin size={10} /> تحكم في موقع اللوكيشن</p>
                                        <div className="grid grid-cols-2 gap-2">
                                            <div>
                                                <span className="text-[9px] text-gray-400">تحريك أفقي</span>
                                                <input type="range" min="-200" max="200" value={locationX} onChange={(e) => setLocationX(Number(e.target.value))} className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer" />
                                                <div className="text-[8px] text-gray-500 mt-1 text-center">{locationX}px</div>
                                            </div>
                                            <div>
                                                <span className="text-[9px] text-gray-400">تحريك رأسي</span>
                                                <input type="range" min="-200" max="200" value={locationY} onChange={(e) => setLocationY(Number(e.target.value))} className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer" />
                                                <div className="text-[8px] text-gray-500 mt-1 text-center">{locationY}px</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-gray-800 p-4 rounded-lg border border-gray-700 shadow-sm"><div className="flex items-center justify-between mb-2"><label className="text-xs font-bold text-gray-400 uppercase flex items-center gap-2"><MapPin size={14} /> إضافة موقع</label><div className="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in"><input type="checkbox" id="toggle" checked={showLocation} onChange={() => setShowLocation(!showLocation)} className="absolute block w-5 h-5 rounded-full bg-white border-4 appearance-none cursor-pointer border-gray-600 transition-all duration-300 ease-in-out"/><label htmlFor="toggle" className={`block overflow-hidden h-5 rounded-full cursor-pointer ${showLocation ? currentThemeConfig.accentColor : 'bg-gray-600'}`}></label></div></div>{showLocation && <input type="text" value={location} onChange={(e) => setLocation(e.target.value)} className="w-full bg-gray-900 border border-gray-600 rounded px-2 py-1 text-sm text-white focus:border-cyan-500 text-right transition-colors" placeholder="اسم المكان" />}</div>
                            
                            {activeTheme !== 'image' && (
                                <div className="space-y-2"><label className="text-xs font-bold text-gray-400 block uppercase">النص الرئيسي</label><textarea value={text} onChange={(e) => setText(e.target.value)} className="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white focus:border-cyan-500 text-right h-24 transition-colors" /><div className="pt-2 space-y-3"><div><div className="flex justify-between text-xs text-gray-500 mb-1"><span>حجم الخط</span><span>{fontSize}px</span></div><input type="range" min="16" max="60" value={fontSize} onChange={(e) => setFontSize(e.target.value)} className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer" /></div><div><div className="flex justify-between text-xs text-gray-500 mb-1"><span>تباعد الأسطر</span><span>{lineHeight}</span></div><input type="range" min="1.0" max="2.5" step="0.1" value={lineHeight} onChange={(e) => setLineHeight(e.target.value)} className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer" /></div></div></div>
                            )}

                             <div className="space-y-2"><label className="text-xs font-bold text-gray-400 block uppercase">المصدر</label><input type="text" value={source} onChange={(e) => setSource(e.target.value)} className="w-full bg-gray-800 border border-gray-700 rounded-lg px-3 py-2 text-white text-sm focus:border-cyan-500 text-right transition-colors" placeholder="المصدر..." /></div>
                            <div className="grid grid-cols-1 gap-2"><label className="flex flex-col items-center justify-center gap-2 bg-gray-800 hover:bg-gray-700 border border-gray-700 border-dashed rounded-lg p-3 cursor-pointer text-center h-20 transition-colors"><ImageIco size={18} className={currentThemeConfig.iconColor} /><span className="text-[10px] text-gray-300">رفع صورة التصميم</span><input type="file" className="hidden" accept="image/*" onChange={handleImageUpload} /></label></div>
                            <div><div className="flex justify-between text-xs text-gray-500 mb-1"><span>سطوع الصورة</span><span>{imgBrightness}%</span></div><input type="range" min="50" max="150" value={imgBrightness} onChange={(e) => setImgBrightness(e.target.value)} className="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer" /></div>
                        </div>

                        {downloadError && (
                            <div className="mt-4 p-3 bg-red-900/50 border border-red-700 rounded-lg">
                                <p className="text-xs text-red-300 text-center">{downloadError}</p>
                            </div>
                        )}

                        <button onClick={handleDownload} disabled={isGenerating} className={`mt-6 w-full ${currentThemeConfig.accentColor} text-white font-bold py-4 rounded-xl shadow-lg flex items-center justify-center gap-3 transition-all hover:opacity-90 transform hover:scale-[1.02] disabled:opacity-50 disabled:cursor-not-allowed`}>
                            {isGenerating ? (
                                <>
                                    <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-white"></div>
                                    جاري التحميل...
                                </>
                            ) : (
                                <>
                                    <Download size={20} /> تحميل (HD)
                                </>
                            )}
                        </button>
                    </div>

                    <div className="flex-1 bg-gray-950 flex items-center justify-center p-4 relative overflow-hidden min-h-screen">
                        <div ref={canvasRef} className={`design-canvas relative overflow-hidden text-right shrink-0 ${isGenerating ? 'exporting' : ''}`} style={{ width: currentStyle.width, height: currentStyle.height, backgroundColor: activeTheme === 'number' ? '#111' : currentThemeConfig.primary }}>
                            <div className="absolute top-0 left-0 w-full h-full flex items-center justify-center">
                                <div ref={imageContainerRef} className="relative" style={{ width: '100%', height: '100%', transform: `translate(${imgPos.x}px, ${imgPos.y}px) scale(${imgScale})`, transformOrigin: 'center' }} onMouseDown={(e) => handleMouseDown(e, 'move')} onTouchStart={(e) => handleTouchStart(e, 'move')}>
                                    {mainImage && (
                                        <img 
                                            src={mainImage} 
                                            className="max-w-full max-h-full w-auto h-auto" 
                                            style={{ filter: `brightness(${imgBrightness}%)`, display: 'block' }} 
                                            crossOrigin="anonymous"
                                            alt="خلفية التصميم"
                                        />
                                    )}
                                    <div className="absolute inset-0 pointer-events-none" style={{ background: getFadeOverlayStyle() }} />
                                    {!isGenerating && (
                                        <>
                                            <div className="image-border"></div>
                                            <div className="resize-handle top-0 left-0 -translate-x-1/2 -translate-y-1/2 cursor-nwse-resize" onMouseDown={(e) => handleMouseDown(e, 'resize')} onTouchStart={(e) => handleTouchStart(e, 'resize')} style={{borderColor: activeTheme === 'number' ? '#ff5a4c' : currentThemeConfig.primary}}></div>
                                            <div className="resize-handle top-0 right-0 translate-x-1/2 -translate-y-1/2 cursor-nesw-resize" onMouseDown={(e) => handleMouseDown(e, 'resize')} onTouchStart={(e) => handleTouchStart(e, 'resize')} style={{borderColor: activeTheme === 'number' ? '#ff5a4c' : currentThemeConfig.primary}}></div>
                                            <div className="resize-handle bottom-0 left-0 -translate-x-1/2 translate-y-1/2 cursor-nesw-resize" onMouseDown={(e) => handleMouseDown(e, 'resize')} onTouchStart={(e) => handleTouchStart(e, 'resize')} style={{borderColor: activeTheme === 'number' ? '#ff5a4c' : currentThemeConfig.primary}}></div>
                                            <div className="resize-handle bottom-0 right-0 translate-x-1/2 translate-y-1/2 cursor-nwse-resize" onMouseDown={(e) => handleMouseDown(e, 'resize')} onTouchStart={(e) => handleTouchStart(e, 'resize')} style={{borderColor: activeTheme === 'number' ? '#ff5a4c' : currentThemeConfig.primary}}></div>
                                        </>
                                    )}
                                </div>
                            </div>
                            <div className="absolute inset-0 pointer-events-none" style={{ background: getGradientBackground() }} />
                            <div className="grid-image-layer">
                                <img 
                                    src={gridUrl} 
                                    alt="grid" 
                                    style={{opacity: activeTheme === 'image' ? 0.3 : 1}}
                                    crossOrigin="anonymous"
                                />
                            </div>
                            <div className="absolute inset-0 noise-overlay"></div>
                            <div className="absolute inset-0 vignette-overlay"></div>
                            
                            <div className="absolute inset-0 z-30 p-6 pointer-events-none flex flex-col items-center">
                                {showLocation && (
                                    <div className="absolute z-50" style={{
                                        right: `calc(32px + ${locationX}px)`,
                                        top: `calc(32px + ${locationY}px)`
                                    }}>
                                        <div className="location-simple">
                                            <MapPin size={12} className={`flex-shrink-0 ${currentThemeConfig.iconColor}`} />
                                            <span className="location-text-simple text-white whitespace-nowrap leading-none" style={{ 
                                                fontFamily: customFont,
                                                paddingTop: '1px' // رفع النص قليلاً للأعلى
                                            }}>{location}</span>
                                        </div>
                                    </div>
                                )}

                                {/* THEME LAYER: Breaking or Number */}
                                <div className="mt-auto w-full flex flex-col items-center">
                                    {activeTheme === 'breaking' && (
                                        <div className="w-full flex flex-col items-center mb-6 relative urgent-image" style={{ 
                                            transform: `translate(${urgentX}px, ${urgentY}px)`,
                                            marginBottom: '1rem'
                                        }}>
                                            <img 
                                                src={urgentUrl} 
                                                alt="عاجل" 
                                                className="relative z-10 drop-shadow-lg object-contain"
                                                style={{ 
                                                    height: `${urgentSize}px`,
                                                    width: 'auto'
                                                }}
                                                crossOrigin="anonymous"
                                            />
                                        </div>
                                    )}

                                    {activeTheme === 'number' && (
                                        <div className="w-full flex flex-col items-center relative mb-8">
                                            {/* رقم اليوم مع تأثيرات مميزة */}
                                            <div className="number-container" style={{ transform: `translateY(${numberY}px)` }}>
                                                <div className="number-backdrop"></div>
                                                <span 
                                                    className="font-bold text-white leading-none drop-shadow-xl number-glow" 
                                                    style={{
                                                        fontFamily: customFont,
                                                        fontSize: `${numberSize}px`,
                                                        marginBottom: '8px',
                                                        ...getGlowStyle()
                                                    }}
                                                >
                                                    {specialNumber}
                                                </span>
                                                
                                                {specialUnit && (
                                                    <span 
                                                        className="font-normal text-[#ffcdba] leading-none" 
                                                        style={{
                                                            fontFamily: customFont,
                                                            fontSize: `${unitSize}px`,
                                                            display: 'block'
                                                        }}
                                                    >
                                                        {specialUnit}
                                                    </span>
                                                )}
                                            </div>
                                        </div>
                                    )}
                                </div>

                                {/* TEXT HEADING LAYER (INDEPENDENT) */}
                                {activeTheme !== 'image' && (
                                    <div className="w-full text-center pb-12 z-40" style={{ transform: `translateY(${textY}px)` }}>
                                        {activeTheme !== 'breaking' && activeTheme !== 'number' && (
                                            <div className="flex gap-2 mb-4 justify-center">
                                                <div className={`h-1 w-16 rounded-full opacity-80 ${currentThemeConfig.accentColor}`}></div>
                                                <div className="h-1 w-8 bg-gray-500 rounded-full opacity-60"></div>
                                            </div>
                                        )}
                                        
                                        {activeTheme === 'number' && titleStyle === 'ribbon' ? (
                                            <div className="title-ribbon mb-4">
                                                <h1 className="text-white font-bold drop-shadow-xl whitespace-pre-wrap" style={{ fontSize: `${fontSize}px`, fontFamily: customFont, lineHeight: lineHeight }}>
                                                    {text}
                                                </h1>
                                            </div>
                                        ) : (
                                            <h1 className="text-white font-normal drop-shadow-xl whitespace-pre-wrap" style={{ fontSize: `${fontSize}px`, fontFamily: customFont, lineHeight: lineHeight }}>
                                                {text}
                                            </h1>
                                        )}
                                    </div>
                                )}

                                {/* FOOTER LAYER */}
                                <div className={`absolute z-40 ${format === 'story' ? 'left-1/2 -translate-x-1/2 bottom-8' : 'left-8 bottom-8'}`}>
                                    {format === 'story' && (
                                        <div className="flex flex-col items-center justify-center mb-2">
                                            <div className="w-2 h-2 border-l-2 border-t-2 border-white transform rotate-45 mb-[-3px] opacity-70"></div>
                                            <div className="w-2 h-2 border-l-2 border-t-2 border-white transform rotate-45 opacity-70"></div>
                                        </div>
                                    )}
                                    <img 
                                        src={logoUrl} 
                                        alt="Logo" 
                                        className="w-16 h-auto object-contain drop-shadow-lg"
                                        crossOrigin="anonymous"
                                    />
                                </div>
                                {source && (
                                    <div className={`absolute z-40 ${format === 'story' ? 'right-8 bottom-8' : 'right-8 bottom-8'}`}>
                                        <p className="text-[9px] text-gray-300 font-normal opacity-90 drop-shadow-md" style={{ fontFamily: customFont }}>{source}</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
[file content end]